# 无线区块链共识算法研究

## 第一章 绪论

### 1.1 研究背景及意义

互联网的蓬勃发展使得对多方协作的安全性和可信性要求越来越高。随着多方协作的规模越来越大，传统的第三方信任机构会伴随着较高的人为决策风险和成本。因此，在中心化机构已经无法满足大规模协作需求的情况下，区块链技术作为新的信用体系应运而生。

自2008年中本聪[1]提出比特币后，其底层技术—区块链受到了工业和学术领域的高度关注。区块链本质上是一个去中心化的数据库，结合了P2P网络、分布式数据库、共识算法、非对称加密等多种技术。区块链应用的P2P网络中各节点的计算机地位平等，每个节点有相同的网络权力，不存在中心化的服务器。所有节点间通过特定的软件协议共享部分计算资源、软件或者信息内容。在无可信第三方的场景中，区块链为信息与价值传递交换提供一种安全的协作模式，解决信任和安全问题。

区块链的发展大致经历了三个发展阶段：区块链1.0、区块链2.0和区块链3.0时代。区块链1.0时代，区块链技术主要是作为数字货币的底层支撑技术。在这个时期,区块链技术的发展与数字货币密切相关,应用普遍集中在货币转移、兑换和支付等方面。随后区块链2.0时代主要是解决市场的去中心化，这个时期的发展与合约技术的发展密切相关。V.Buterin[2]首次提出实现智能合约编写的以太坊区块链平台，将智能合约和区块链技术结合使得区块链技术得以提升。区块链为智能合约提供可信执行环境,而智能合约便于区块链扩展应用。随着时间的推移,这项技术的应用超越了货币,延伸至更广阔的领域,并具备了更大的兼容性。区块链3.0时代也是区块链全面应用的时代,由此构建一个大规模协作社会。除金融、经济等方面,此时的区块链在社会生活中的应用更为广泛,特别是在政府、健康、科学、文化和艺术等领域。区块链技术无论是在构建价值自由流通的互联网，还是在企业基于建立联合多中心的数据共享方面，都有着广阔的应用前景。

随着5G和物联网的普及，在无线节点之间管理设备、共享消息和执行计算任务等面临的问题越来越多，在具有小世界和超密集特征的无线网络中，安全和信任问题甚至变得难以处理。无线网络具有高灵活性、便捷性、易于网络规划和调整、故障定位容易以及易于扩展等优点。但是无线网络面临着严重的网络安全问题，包括女巫攻击、无线信道劫持攻击、日蚀攻击、窃取网络资源等，这些都会对建立在无线网络上的应用产生致命伤害。

区块链的安全可信任特性可以为无线网络的应用提供安全和信任保障。如果将无线网络应用中数据的上传和在应用中的操作都当作区块链交易来处理，则可以在传输层面保护数据和通信安全。区块链可以将设备映射为公私密钥，数据的上传视为由智能合约验证的交易事务，区块链使用非常先进的加密技术来确保事务信息被锁定在区块链中，安全性相比不使用区块链技术的无线网络应用得到了很大的加强。

区块链技术可以有效的解决建立在无线网络上的应用中的安全信任问题，确保数据的安全性、可信性和完整性，但是区块链技术应用于无线网络场景还面临着一些挑战。一方面，区块链的区块链系统的性能很大程度上是受共识算法的限制的。目前主流的区块链共识算法主要有PoW共识算法,PoS共识算法以及PBFT共识算法等。这些共识算法具有能耗巨大、效率低、依赖代币和网络通信复杂度高等缺点。另一方面，无线网络可用资源的波动性和移动终端设备可用资源的有限性，无法满足目前需要耗费大量计算资源以及需要稳定的网络传输数据的区块链系统的需求。因此，亟需根据无线网络的特性设计高效节能的区块链共识算法，使得引入区块链技术的无线网络应用具有很好的扩展性和安全性。

### 1.2 国内外现状


随着无线通信技术和区块链技术的高速发展，许多研究倾向于将区块链技术用于无线应用中，如移动边缘计算、智能5G、车联网、物联网等。J. Feng等人 [8]通过无线电和计算资源分配提出了一种区块链和移动边缘计算的联合优化的框架。Y. Dai等人[9] 融合区块链和人工智能技术，提出了用于新一代无线网络的安全和智能架构。N. Malik等人 [10]利用区块链技术实现在车联网中安全的密钥管理。S. Guo等人 [11] 构建了基于区块链的认证系统，实现了异构物联网平台之间的可信数据共享。O. Onireti 等人 [12] 提供了一个可以获得基于无线 PBFT 的区块链网络的可行区域的分析建模框架。Y. Ren等人 [13] 建立了一种基于 PoW 的区块链的去信任机制来激励节点存储数据。M. Liu等人 [14] 在无线区块链网络中用移动边缘节点实现了计算卸载和内容缓存。Y. Sun等人 [15] 提出了一个研究无线区块链系统的性能和安全性如何受到无线通信影响的分析框架。将区块链应用于无线网络中的研究很多，因此我们迫切地需要设计适用无线网络的区块链协议。

目前，与无线网络相关的区块链研究主要是在经典的区块链共识算法的之上提出架构或构建系统。基于工作量证明的共识算法[1]要求用户通过证明其对能源和存储等物理资源的利用来获得出块权限最终达成共识。基于权益证明的共识算法[16]要求用户通过声誉和权重竞争获取出块权限达成共识。基于委员会的混合区块链共识算法[17]要求委员会内通过通信达成一致性。尽管这些共识算法在现有区块链协议中表现良好，但它们不适用于无线网络。因为这些共识算法主要是为将互联网作为底层网络的系统开发的。无线网络没有像互联网那样使用光纤等物理导线构建可靠的通信信道，开放式空中通信使得无线网络容易受到严重的环境影响，比如：信道带宽可变，通信容易受到干扰攻击，节点网络拓扑的动态变化等。这些障碍容易呆滞通信失败，使得传统的区块链共识算法不适合直接用于无无线网络中。现有的区块链协议并没有充分解决这些问题，这推动了我们对无线区块链共识算法的研究。

针对传统的区块链共识算法不适用于无线网络，一些研究根据无线通信的自然特性提出了适用于无线网络的区块链共识算法。BLOWN[3] 提出新的适用于单跳无线网络的信道证明共识算法。针对多跳无线网络环境，wChain[4] 则提出一种利用Spanner作为通信骨架能够快速处理交易且具有较高容错性的区块链协议。J.Zhen等人[5]根据无线网络节点的移动特性提出一种具有较好稳定性的基于工作量证明的共识算法。Q. Xu等人[6]提出了基于SINR模型的共识协议，在单跳无线网络中可以在$O(\log n)$内达成共识。Y. Zou等人[7] 设计一种适用于单跳无线网络的可以在$O(k + \log n)$中达成$k$次共识的算法，提高了达成共识的效率。对于区块链与无线网络以及共识算法的研究一直在不断深入，但是仍然还有许多问题要解决。

### 1.3 本文的研究内容

本文主要研究适用于无线网络的区块链共识算法。首先了解区块链的体系架构和无线网络的特性。对当前的区块链共识算法进行深入研究，包括单链区块链共识算法和DAG区块链共识算法，并指出各种共识算法不适用于无线网络的原因。因此需要根据无线网络的特性设计新的区块链共识算法。

首先在无线自组织网络场景下，针对无线网络节点计算资源有限且具有高动态性的特点，设计基于节点稳定性的无线区块链网络共识算法。从新节点加入网络的自启机制、节点稳定性的定义、首领节点的选举以及区块的确认等几方面进行共识算法的研究和分析，最终提出基于节点稳定性的区块链共识算法，并结合仿真实验来说明新共识算法的性能优化。

随后针对需要实时交易处理的无线自组织网络场景，对基于委员会的混合共识算法进行分析。考虑混合共识算法需要面对的委员会选举、委员会首领选举、委员会一致性协议以及委员会重置等问题，分析无线网络的通信特性，研究出基于稳定委员会的区块链共识算法，分析并仿真测试该算法的性能。

针对大规模无线自组织网络场景，网络区域变大节点数量增加时会导致单委员会执行一致性协议的通信增加。最终，节点的网络通信资源的消耗和达成共识所需的时间也会增加，从而影响共识算法的性能。网络分片可以降低节点之间传输数据给通信网络带来的巨大压力和挑战。针对网络分片的无线自组织网络，需要采用多委员会的区块链共识算法提高处理效率。因此，需要对多委员会共识算法进行分析和研究，结合无线网络的特性设计出基于稳定分片的区块链共识算法，分析并仿真测试该共识算法的性能。

单链区块链共识算法的性能受到区块大小和区块生成时间间隔的限制，随着节点的增加区块链的性能将受到极大的影响。DAG区块链具有高并发特性，有望解决传统区块链的性能瓶颈得到工业和学术界的高度关注。因此，通过对DAG区块链共识算法进行深入的分析和研究，考虑无线自组织网络资源有限和网络拓扑动态变化的特性，设计出基于稳定主链的DAG区块链共识算法。

### 1.4 论文结构

第一章为绪论，主要介绍区块链技术与无线网络的发展背景，以及区块链应用于无线网络中的研究现状，在此背景与研究现状的基础上提出本文的研究内容。

第二章主要介绍区块链共识算法相关的理论知识，并且对目前的区块链共识算法进行分类比较。

第三章介绍了无线区块链网络的特性，并重点分析无线区块链共识算法当前面临的主要问题。主要从节点自启机制、共识节点的选举、共识过程的瓶颈几个方面进行分析。

第四章主要介绍针对当前无线区块链共识算法面临的问题给出相应的解决方案。主要包括基于节点位置的随机自启机制、基于节点稳定度和随机可验证函数的共识节点选举机制、基于门限签名的一致性协议。

第五章介绍了相应的研究成果

第六章对本文的研究工作进行了总结，然后指出文章中还存在的不足之处，最后分析今后的研究方向。

## 第二章 区块链共识算法

区块链系统的性能很大程度上是取决于所采用的共识算法的性能，共识算法决定了参与节点以何种方式对区块达成一致。本章重点介绍区块链共识算法的概念和性质，之后对共识算法的结构进行分析，最后对当前的区块链共识算法进行详细描述。

### 2.1 区块链共识算法概念和性质

区块链共识算法主要解决区块链系统中相互独立的节点维护区块链的一致性问题。区块链系统是在更加开放并且缺乏信任的网络环境中运行，因此设计区块链系统的共识算法时必须考虑面临的“拜占庭将军问题”。

“FLP不可能定理”指出在网络可靠的异步通信系统中，即使只存在一个节点故障，也不存在一致性协议能够在有限时间内使得系统达成一致。因此，研究者通过调整问题模型来规避区块链系统面对的“FLP不可能定理”问题，寻找工程上可行的共识算法。区块链系统中假定网络是部分同步的，即节点之间可以快速同步，且节点生成一个区块的时间是有限的，这样就可以规避“FLP不可能定理”问题。

“CAP定理”指出分布式系统是无法同时满足一致性、可用性和分区容忍性，最多能够同时满足其中两个特性。
* **一致性**：分布式系统中所有节点在同一时刻拥有相同的数据和操作信息；
* **可用性**：分布式系统处于服务状态，客户端发出的请求能在有限时间内受到来自服务器端返回的结果；
* **分区容忍性**：允许网络中部分节点不与其他节点通信，即允许网络分区（不同区域之间的节点不能建立通信）。

"CAP理论"为共识算法的是记者提供了指导性原则，研究者不再追求设计能够同时满足三个性质的共识算法。比如，区块链系统中工作量证明共识算法要求全网节点参与竞争出块权、验证交易和区块的有效性、最后达成共识（不支持分区容忍性），但是能够一定程度上满足一致性和可用性，并且具有拜占庭容错性。

区块链中的共识算法是让分布式系统中所有的节点对于本地维护的区块链账本达成一致，因此需要满足以下三个性质：
* **终止性**：区块链系统中每个诚实矿工都会在有限时间内将一个有效的交易或者区块写入自己的本地区块链上；
* **有效性**：如果所有的诚实矿工都支持相同的有效交易会区块，那么这个交易或区块将被写入每个诚实矿工的本地区块链中；
* **一致性**：每个有效的交易或区块都应该被每个诚实矿工写入本地区块链中。对于每个诚实的矿工，其本地区块链中写入的区块应该分配相同的序列号。

区块链作为一个公开透明、任何节点都能够随时访问、添加信息的的公共账本需要满足两个安全特性：持续性和活性。
* **持续性**：诚实矿工在账本的某个位置, 如第 $i$ 个区块的第 $j$ 个位置上传了合法交易 $tx$, 则最终所有诚实矿工的区块链中, 第 $i$ 个区块的第 $j$ 个位置的交易一定存在, 且一定是 $tx$。
* **活性**：在某个时间, 诚实矿工上传了交易 $tx$ 至区块链, 则在等待时间 $t$ 之后, 交易 $tx$ 一定出现在每个诚实矿工维护的区块链中.

在讨论区块的安全性时，可以定义一些度量来进行讨论：共同前缀、链质量和链增长。
* **共同前缀**(Common Prefix)：对任意两个诚实的节点 $v_1, v_2$ 在两轮 $r_1, r_2$ 中提交的链 $C_1, C_2$，一定满足 $C_1^{\lfloor k}\preceq C_2^{\lfloor k}$ 或 $C_2^{\lfloor k}\preceq C_1^{\lfloor k}$，其中 $k\in \mathbb{N}$ 是安全参数,  $C_1^{\lfloor k}$ 表示链 $C_1$ 中去掉尾部的 $k$ 个区块， $C_1 \preceq C_2$ 表示 $C_1$ 是 $C_2$ 的前缀。即当 $r_1 \leq r_2$ 时， 满足 $C_1^{\lfloor k}\preceq C_2^{\lfloor k}$；当 $r_2 \leq r_1$ 时， 满足 $C_2^{\lfloor k}\preceq C_1^{\lfloor k}$。（区块链的共同前缀特性表明诚实节点维护的链最终会保持一致，且已经确定的链将不会被改写）
* **链质量**(Chain Quality)：任意诚实节点 $v$ 的链 $C$ 中除去最新的 $k\in\mathbb{N}$ 个区块后，任意 $\ell\in\mathbb{N}$ 个连续区块中，恶意节点生成的区块比例不超过 $\mu$，其中 $\mu\in\mathbb{R}$ 是安全参数。（链质量是指连续区块中必须有足够比例的诚实节点生成的区块）
* **链增长**(Chain Growth)：对任意轮 $r > r_0, r, r_0\in\mathbb{N}$，记诚实节点 $v$ 在第 $r, r+s, s\in\mathbb{N}$ 轮中输出的区块链分别为 $C_1, C_2$，那么就有 $|C_2| - |C_1| \geq \tau\cdot s$，其中 $\tau\in\mathbb{R}$ 是安全参数。

除了安全性以外，区块链特性还包括公平性。
*  **公平性** (Fairness): 诚实节点实际产生的区块占比大致与诚实节点的算力占比(或与诚实节点所拥有的财产占比) 相符。

区块链共识算法的一致性分为两种：弱一致性和强一致性。
* **弱一致性** (Weak Consistency)： 一般根据出块节点选举的方式, 同一个时期可能有两个甚至两个以上合法的出块节点, 此时区块链可能出现分叉。但是经过一段时间之后, 最终区块链的区块是确定的。
* **强一致性** (Strong Consistency) 强一致性的共识又被称为确定性共识, 通过选取一个确定的委员会, 再由委员会内部运行的分布式一致性算法生成新区块, 每一轮的区块都是确定的, 一般情况下不会产生分叉。
  
相比于弱一致性, 强一致性具有以下优点:
(1) 区块链无分叉, 通过运行分布式一致性算法，实现状态机复制, 节点不需要浪费大量算力;
(2) 交易能够得到较快速度的确认，节点上传的交易只要被写入到区块中, 便可以确认交易的合法性，完成整个交易过程;
(3) 能够提供前向安全 (forward security)。 只要区块被写入到区块链上, 就可以确保区块不会被篡改，区块将一直保持在链上。

### 2.2 区块链共识算法结构

在设计区块链共识算法时，需要考虑共识算法的网络模型、腐化(Corruption)模型和敌手模型。

一般区块链系统中节点之间通过网络通信。网络模型可以分为同步网络、部分同步网络和异步网络。
* **同步网络** (Synchronous Network)： 诚实节点之间的消息按照轮来传播。在每一轮中,诚实节点发出的消息能够在下一轮之前到达其他所有诚实节点.。同步网络是比较强的网络模型。
* **部分同步网络** (Partially Synchronous Network)：网络中的消息传输存在一定的上限 $\Delta$，时延上限不能作为协议的参数使用，但是能够确保诚实用户发出的消息在 ∆ 时间之后到达其他所有诚实节点。部分同步网络是区块链协议分析中常用的网络模型。
* **异步网络** (Asynchronous Network)：敌手能够任意拖延诚实用户的消息或将其打乱顺序，只要保证最终诚实用户的消息能够到达彼此。

区块链系统中，敌手可以腐化节点。敌手通过向目标节点发动攻击，获取目标节点的秘密信息, 进而控制目标节点的输入输出消息，使其完全受到自身的控制。腐化模型主要分为静态腐化、$\tau-$温和腐化和适应性腐化。
* **静态腐化** (Static Corruption)：敌手只能在协议开始前选定其腐化的目标，一旦协议开始运行便不能够腐化诚实节点.。敌手控制的节点数量在协议运行期间不会发生改变。
* **$\tau-$温和腐化** ($\tau-$Mildly Corruption) 敌手腐化一个节点需要一定的时间 $\tau$ 来完成。敌手发布对目标节点的腐化指令，经过$\tau$ 时间后目标节点被腐化，受到敌手的控制, 成为恶意节点。在实施腐化的$\tau$ 时间内，节点仍然是诚实节点。温和敌手是区块链协议分析中经常采用的腐化模型.
* **适应性腐化** (Adaptive Corruption)：敌手能够根据协议运行过程中搜集的信息，动态且适应性对目标节点完成腐化。适应性敌手的能力十分强大。

区块链系统中敌手模型是指对敌手能够掌握的算力或财产占比作出一定的限制，一般用 $f$ 代表敌手数量，$n$ 代表网络中节点总数。利用 $n$ 与 $f$ 的关系可以将敌手模型,分为如下几类:
*  **$(n = 2f + 1)$：** 敌手算力 (或财产) 占全网算力 (或财产) 的比例不超过$\frac{1}{2}$。比特币采用的敌手模型是 $n = 2f + 1$，敌手算力一旦超过 $\frac{1}{2}$ 便可以制造区块链的分叉，发起 $51\%$ 攻击。
* **$(n = 3f + 1)$：** 敌手算力 (或财产) 占全网算力 (或财产) 的比例不超过 $\frac{1}{3}$。如 PBFT 之类的经典分布式共识机制要求敌手模型为 $n = 3f + 1$，而在一些混合共识中, 受到委员会内部分布式一致性算法的限制, 同样需要敌手模型为 $n = 3f + 1$。
*  **$ (n = 4f + 1)$：** 敌手算力 (或财产) 占全网算力 (或财产) 不超过 $\frac{1}{4}$。考虑到自私挖矿导致链质量下降, 某些混合共识在选举委员会时，为了满足委员会成员中敌手数量不超过 $\frac{1}{3}$，需要要求区块链链质量大于 $\frac{2}{3}$。这种情况下需要满足 $n = 4f + 1$ 才能满足委员会中诚实用户占据 $\frac{2}{3}$以上的要求。

区块链共识过程主要分为几个阶段：选举出块节点、生成区块以及节点验证更新区块链。
* **选举出块节点**：出块节点是区块链系统中负责生成区块的节点。目前出块节点根据数量主要分为两种：单一出块节点和委员会出块节点。出块节点的选举过程需要能够抗女巫攻击。
* **生成区块**：选举的出块节点将交易打包到区块中。区块通过对前一个区块哈希的引用链接成链式。根据出块者与区块数量的对应关系可以将出块过程分为两类：一类是出块者在任期内只生成一个区块；一类是出块者的任期内生成多个区块，将任期分为多轮，每轮生成一个区块。
* **节点验证更新区块链**：出块节点在成功生成区块之后将广播到网络中。接收到区块的节点将验证交易、区块和出块者身份的有效性，若验证成功则将区块添加到本地区块链上，否则将不更新本地区块链。

### 2.3 区块链共识算法分类

区块链共识算法按照区块链的存储结构可以大致分为单主链区块链共识算法和DAG区块链共识算法。

#### 2.3.1 单主链区块链共识算法

在单主链的区块链系统中共识算法大致分为：基于工作量证明共识算法、基于股份证明的共识算法、委员会共识算法（单一委员会混合共识算法、多委员会混合共识算法）以及其他共识算法。

* **基于工作量证明的区块链共识算法**
 工作量证明最早C.Dwork和M.Naor[18]在1992年提出，用来解决垃圾邮件问题.该机制要求邮件在被发送之前必须完成某个数学难题的答案来证明确实执行了一定量的工作。A.Back在1997年提出,并在2002年正式发表的Hashcash [19]通过寻找哈希函数原像实现工作量证明。在1999年，M.Jakobsso[20]正式提出了工作量证明的概念。这些工作都为比特币的共识机制奠定了坚实的基础。
  
 为了解决无可信第三方的安全交易的问题，中本聪[1]采用工作量证明的共识算法为电子货币的交易达成安全共识。在区块链中，工作量证明主要用来防止敌手制造假身份发动女巫攻击。这种共识算法中所有参与共识的用户需要消耗算力解决一个数学难题，证明自己完成了一部分工作来获得生成区块的权限。随后，系统通过一个链式结构来确保达成共识的账本不可篡改，保证了账本的安全性。用户需要等到区块被确认后，才可以获得系统的奖励以及区块中所有交易费用。
  
  工作量证明共识算法提出之后，一些研究者针对比特币的安全性进入深入研究。J.Garay等人[21]提取和分析了比特币的协议核心，针对区块链的共同前缀、链质量和链增长特性，证明了在算力充足和同步网络下区块链的安全性，为加密货币的共识算法提供了首个“可证明安全”模式。R.Pass等人[22]在此基础上进一步分析了区块链在部分同步的网络环境下区块链的安全性。此外，工作量证明共识算法也存在被敌手攻击的可能性，常见的攻击有日蚀攻击[23]、双花攻击以及自私挖矿攻击[24]等。I.Eyal[25]通过分析比特币中自私挖矿的成功概率，最终证明了敌手可以只需要控制全网的少部分算力就能攻击系统成功。
  
  采用工作量证明的区块链系统中矿工可以集中计算资源发起自私挖矿攻击而获益，为了解决比特币中挖矿资源集中化的问题，以太坊[2]设计抵抗ASIC且支持轻量级客户端快速验证的工作量证明算法Ethash。为了让拥有较少算力资源的用户获得奖励，Ethash降低了找到工作量证明的难度。但是降低挖矿难度会提高出块速率，以太坊中出现分叉的频率也会提升。对低算力矿池和节点缺乏分支竞争力的问题，以太坊中采用的叔块(Uncle block)机制使得分叉区块也会被后出现的区块引用，最终 Ethash在确保系统安全性的时候提升交易吞吐量的同时降低了交易确认延时。除了在电子加密货币上的应用，区块链也可以作为智能合约的底层技术。以太坊是一个能够运行智能合约的公共区块链平台，允许双方在没有可信第三方的情况下实现可信交易。
  
  为了解决比特币中自私挖矿攻击导致的诚实用户链质量的下降的公平性问题，R.Pass和E.Shi[26]提出了水果链（FruitChains）。其共识算法也是基于工作量证明的，水果链引入了两种数据结构：区块和水果（fruits）。区块和水果的产生都是通过寻找工作量证明来完成,但是生一个区块需要完成工作量证明的难度要远远高于生成水果的难度。其中水果是挂靠在区块下的，而交易则是与水果绑定的。新挖到水果被放入有效水果集(Fruit set)中，有效水果集合随着水果的挖出不断更新。新挖到的区块将有效水果集中的水果放入到区块中，由于系统需要确保水果的新鲜度（fresh），因此自私挖矿生成的区块和水果不会被诚实矿工接受。最终几个区块和水果的奖励会平均奖励给所属节点。在FruitChains中,用户不需要加入矿池就能频繁获得挖矿收益,提升了用户获取奖励的公平性。
  
  针对工作量证明共识算法中ASIC设备算力集中化问题，M.H.Ashilk等人[27]提出采用回合制的过滤工作证明共识算法 (FPoW)来解决。在每一回合开始时，都会有一个一定难度级别的虚拟数学谜题来计算采矿设备的计算能力。这将使系统能够找出基于ASIC的挖矿节点，所有基于ASIC 采矿设备都将在列表的顶部。根据该列表，系统会从网络中移除一些算力比其他节点更大的挖矿节点。完成所有过滤后，原工作量证明机制将在剩余的挖矿节点之间运行。最先找到工作量证明的挖矿节点将创建一个新区块并获得奖励。在每一轮之后，网络将允许连接新节点或移除旧节点。这个共识算法可以较好的防止由于ASCI设备带来的算力集中化问题，提高参与用户获得奖励的公平性。
  
  采用工作量证明共识算法的区块链系统面临着交易吞吐量低的问题，研究者对提升区块链的交易处理速率做了深入研究。I.Eyal等人[25]提出的Bitcoin-NG也是一种基于工作量证明的共识算法。Bitcoin-NG采用的微块机制提升了比特币中完成一次工作量证明能够处理交易的数量。同时，Bitcoin-NG也改变了比特币的激励机制，提升了诚实矿工愿意在诚实链后添加区块的积极性，降低了区块链分叉的动机。Bitcoin-NG能够在提升交易吞吐率的同时保证协议的安全性和公平性。这个共识算法将交易区块与关键块节点选举的过程分离开来, 体现了协议设计的模块化思想。
  
  工作量证明的共识算法面临着严重的能耗问题和双花攻击问题。现有的基于工作量证明的共识算法主要是解决自私挖矿攻击引起的不公平问题，提升交易的处理速率。但是工作量证明的寻找需要投入大量的算力，这对于资源有限的用户或者设备是非常不友好的。同时，这些算力的消耗除了用于工作量证明的寻找并没有其他的效益，这使得能源浪费十分严重。由于基于工作量证明的共识算法只具有弱一致性，因此敌手可以通过在同一个区块的不同分叉上挖矿发起双花攻击来使自己受益。工作量证明共识算法对这种攻击只能通过降低敌手的攻击意愿，并没有比较好的方式能够完全杜绝。

* **基于权益证明的区块链共识算法**
 权益证明的共识算法主要是为了解决工作量证明中能源消耗巨大的问题。基于权益证明的共识算法中用户根据拥有资产的比例来决定成为下一个出块者的概率。任何用户生成区块不需要消耗大量的计算算力，对环境比较友好。
 
 由S.King和S.Nadal[28]提出的点点币引入了权益证明共识算法。该共识算法根据用户持有代币的币龄来选择生成新区块的节点。节点代币越多、持币时间越长则生成区块的概率则越大。权益证明共识算法可以快速生成区块，具有较大的交易吞吐量和较低的交易确认延时。但是，基于权益的共识算法面临着节点长期离线和敌手攻击的威胁，主要有无利害关系攻击[29]、打磨攻击[30]、长程攻击[31]、权益窃取攻击[32]等。

 针对权益证明共识算法面临着无利害关系攻击、离线攻击和长程攻击的问题，V.Buterin等人[33]提出的Casper FFG是用于以太坊的基于PoS共识算法。其中区块产生仍然依靠以太坊的Ethash工作量证明算法,但是每隔50个区块出现一个检查点,验证者通过PoS的方式来对检查点完成最终确定。Casper FGG共识算法中的检查点机制解决了PoS共识算法中的长程攻击。对于无利害关系攻击，Casper FGG采用质押机制来解决。验证者需要将持有的以太币质押到系统的智能合约中，节点被选中的概率与其质押的以太币成正比。如果发现参与者想要发起发利害关系攻击，就没收其保证金。对于PoS共识算法中节点长期离线的问题，也采用罚没一定数量的代币来确保节点愿意保持在线，确保系统的安全性与活性。Casper FFG采用惩罚机制使得节点有长期保持在线的理由，从而确保安全性。

 针对PoS共识算法中节点长期离线问题和交易效率低的问题，委托权益证明(delegated proof of stake, DPoS)[34]采用委托人的方式对确保区块生成的可信性以及达成共识的高效性。权益持有者投票给信任的委托人,票数与其权益大小成比例关系,最终选出101名委托人以平等的权利轮流作为区块生产者行使权利。如果委托人在委任期间未按规则产生正确区块,该委托人将会被除名,所有权益持有者选出新的超级节点将其替代，避免了节点长期离线的问题。这个共识算法消除了交易需要等待一定数量的区块被非信任节点验证的时间，降低了交易确认延时。同时，委员会机制也避免了参与者在不同分支上生成区块的无利益关系攻击和长程攻击。DPoS以选举委托人的形式实现共识,但是带来了严重的中心化问题。

 针对PoS共识算法处理交易的效率低和面临打磨攻击的问题，A.Kiayias等人[35]提出了一种新的基于权益证明的共识算法Ouroboros。该共识算法利用形式化的方法建立了PoS共识算法的模型,并证明了Ouroboros能够满足安全性。共识算法将时间分为多个时期，每个时期分为多轮，每轮最多产生一个区块。在每个时期开始，共识算法根据节点所持有的股份选出这个时期的出块候选人，并且随机的选举出下一轮的出块节点。Ouroboros使用安全多方计算协议生成的随机数使得共识过程在存在敌手时具有较高抗偏置性，即具有抗打磨攻击性。Ouroboros通过多方验证交易和区块的方式防止敌手对共识算法发起无利益关系攻击。Ouroboros的激励机制是将多个区块的交易费根据节点的贡献度按比例分配，这个机制激励权益持有者愿意保持在线获得收益，从而解决节点长期离线问题。

 为了防止Ouroboros共识算法中敌手对出块者发起的贿赂攻击或DDoS攻击，B.David 等人[36]提出的Ouroboros Praos改进了Ouroboros中出块者的选举方式。这个共识算法中在成功生成区块之前，节点只能确定自己是否被选为出块者但不能提前判断其他节点是否被选中，这样有效防止了敌手做坏的可能。

 对于Ouroboros共识算法中新加入节点的安全自启问题和长程攻击问题，Badertscher 等人 [37] 提出了Ouroboros Genesis。共识算法中新加入的节点通过从不同的节点获得多个链做对比来最终确定与其他链的共同前缀且是最长链。Ouroboros Genesis利用公共前缀的性质在没有采用检查点机制的前提下能够抵抗长程攻击,并且在通用可组合(universally composability)模型下, 形式化证明了协议的安全性。

 对于PoS算法中节点的离线、候选者节点选择机制被敌手偏置和腐蚀等问题，P.Daian等人[38]提出的Snow White是适用于PoS的可重配置共识算法。候选者重配置的间隔时间短暂,能够满足节点随机加入和退出网络的需求。通过重配置过程选出系统中最近的权益拥有者作为候选者集合,然后按集合中成员权益占比随机选择每一轮的出块者，提高了共识算法的抗偏置性。即使节点离线，这个候选人重配置机制也能够提高共识过程的安全性。Snow White中候选者集合随着系统中权益的变化而重新选择,防止敌手的后来腐化(posterior corruption)攻击。共识算法的激励机制是将几个区块的奖励和交易费用平均分给出块者，提高了节点参与共识的活性和公平性。同时，采用了类似于水果链（Fruitchains）的区块和水果生成机制提高区块链的交易处理效率，提升区块链系统的交易吞吐量。

 基于PoS的共识算法虽然解决了PoW共识算法能耗高的问题，但是却由于生成区块不需要大量耗能而面临着敌手攻击的危险。PoS也是一个具有弱一致性的共识算法，因此面临着双花攻击的威胁。PoS中的双花攻击可以利用无利益关系攻击、长程攻击和打磨攻击来实现。当前的工作主要通过押金机制来降低无利益关系攻击，通过检查点机制和单链区块链公共前缀来降低长程攻击，通过随机数机制来提高系统的抗打磨攻击性。新节点自启机制则可以根据单链区块链公共前缀来保证安全。为了提高共识算法的交易处理速率，通过增加生成单个区块处理交易的数量，也可以通过降低交易确认时延。但是这样的方式能够提升的交易吞吐量是非常有限的。

* **单一委员会的混合区块链共识算法**
 混合共识算法的含义是将经典分布式一致性算法与区块链共识算法相结合，即采用PoW或PoS的方式选举特定的委员会，在委员会内部运行经典分布式共识算法生成区块。混合委员会共识算法又分为单一委员会共识算法和多委员会共识算法。采用单一委员会的混合共识算法选举一个委员会负责全网所有交易的处理， 而采用多委员会的混合共识共识算法将选举多个并行运作的委员会，将全网划分为多个片区，分片处理网络中的交易。混合共识算法的一般流程是：选举委员会成员、选举委员会首领、执行委员会内一致性算法、广播区块、更换委员会视图。

 C.Decker等人[39]提出的PeerCensus将经典的分布式一致性算法PBFT与PoW共识算法结合，利用比特币作为底层链选出一定数量的节点完成身份认证，通过在着些节点之间执行PBFT算法来实现区块的生成和确认。该共识算法能够通过身份认证来抵抗女巫攻击，最终能够达成强一致性共识使得链分叉概率极低。由于PeerCensus中节点的进入和离开都需要委员会达成共识，敌手会利用的离开检测机制不断制造离开提议的方式降低整个系统的运行效率。因此，单一委员会混合共识算法需要解决以下问题
 * **新节点安全自启问题** 共识算法需要在不依赖可信启动的方式来完成初始化委员会配置。新节点加入时需要解决节点快速安全的自启问题，确保节点获取交易信息真实有效和识别虚假信息。
 * **委员会选举** 选择委员会成员的时候需要确保诚实成员达到一定比例。委员会内共识的运行需要由领导者发起，因此需要安全的领导者选取机制防止领导者不作为或恶意行为。
 * **委员会一致性协议** 委员会内需要解决客户端提交交易快速响应问题。提高委员会内一致性算法运行效率问题，比如降低委员会通信复杂度、计算复杂度问题和并行提议实现等。
 * **委员会重置** 一个委员会工作时间对应一个时期，共识算法需要合理设置每个时期的长度，防止敌手腐蚀委员会成员。在一个时期结束后，委员会重配置需要解决委员会成员交替时交易的处理问题和敌手干扰委员会新成员选择问题。重置委员会通常是只更换部分成员，随后进入新时期。

 针对敌手影响委员会重置问题，E.Kokoris-Kogias等人[40]提出的ByzCoin采用滑窗方式来实现委员会重置。该共识算法采用PoW的方式防止敌手发起女巫攻击，同时采用Bitcoin-NG的思想来提升交易处理效率。为防止委员会成员被敌手腐蚀，Byzcoin采用滑动窗口的方式重置委员会。通过找到最近的144或1008个关键区块的节点进入委员会，节点的投票权由关键块的比例决定。委员会采用群体签名对微块达成共识，提高交易处理效率。相较于PeerCensus共识算法，该算法中节点的进出不用委员会成员协商提高了委员会重置的效率。但是这个算法没有解决节点自启的问题，也没有解决初始委员会配置问题，还面临着初始委员会配置的问题以及委员会成员更换时交易的处理问题。同时委员会成员的更新速率取决于工作量证明，难度过高会使得委员会成员更换比较慢容易被敌手腐蚀。

 为了解决了委员会重配置时正在进行交易处理的问题，I.Abraham等人[41]提出的Solida共识算法。该算法采用Paxos思想，首先为每个领导者赋予不同等级，新节点加入委员会重配置进入委员会之后等级增加并成为新的领导。Solida共识算法的委员重配置是利用PoW机制进行随机更新。当节点找到一个工作量证明时，该节点的生存时期增加并成为委员会领导，当一个节点长期成为领导时需要更换委员会视图。一旦出现新领导，当前领导任期被打断，经过委员会共识之后新领导接管委员会，之前被打断的提案将重新发起共识。为了防止自私挖矿带来链质量的下降，Solida在PoW中嵌入了随机数，将每一轮提议最终得到的多个签名嵌入到 PoW 中，保证诚实用户的链质量。但是这个共识算法中委员会成员的更新速率比较慢，这会使得委员会成员容易被敌手腐蚀。对于初始委员会的配置问题也没有解决，新节点的安全自启问题也还未解决。

 为了解决初始委员会配置问题和交易的响应速度慢的问题，R.Pass和E.Shi[42]提出Hybrid consensus将PoW与BFT算法结合的混合共识机制,采用滑窗机制更换委员会成员。Hybrid consensus 共识算法首先利用Snailchain选出一个初始静态委员会，诚实节点会根据其局部链去掉尾部中不稳定的 $k$ 个区块，并选择前 $M$ 个区块的出块者作为BFT委员会成员。当诚实节点的链达到长度 $R*M+k$ 时第 $R$ 个委员会成员也是去掉尾部 $k$ 个不稳定区块，选择最后 $M$ 个区块的出块者成为委员会成员。委员会内运行BFT协议来确定交易直到收到停止命令，因此委员会成员会逐渐输出已确认的交易。提交的交易会被记录在每日日志中。该算法首次利用形式化的安全模型和模块化的设计建模混合共识机制，并证明了其能够满足一致性和活性等安全特性。这个共识算法中委员会成员的更新速率比较慢，这会使得委员会成员容易被敌手腐蚀。新节点的安全自启问题也还未解决。采用该共识算法的区块链也容易出现分叉，最终导致委员会成员可能会有不一致的问题。
 
 为了解决采用PoW和一致性算法结合的共识算法中能耗高、委员会更新时间长、交易处理效率低的问题，Y.Gilad等人[43]提出了将PoS与经典分布式一致性算法结合的混合共识算法Algorand。该共识算法采用随机更换机制来重置委员会成员，并且采用随机可验证机制选择委员会首领。首先根据上一轮的区块信息计算本轮的随机数，设置两个不同的值判定节点是否选中成为首领或委员会成员。委员会成员内部执行新的双层共识的拜占庭一致性算法BA⋆ 来解决敌手腐蚀问题。每一轮投票的成员是利用PoS 共识算法在所有权益持有者中随机选择一定数量的委员会成员, 基于PoS选择成员的方式更加快速、高效,可以快速更新委员会。Algrand具有较高的交易吞吐量和扩展性，可用于规模较大的应用场景。该共识算法具有强一致性特性,区块链分叉概率很小,交易能够得到较快速度的确认。

 针对PBFT一致性算法固有的二次消息复杂性，在网络中的节点数量方面存在可扩展性问题，M.M. Jalalzai等人[44]提出了一种新的基于BFT的共识协议Proteus。该共识算法选择一个大小为c的节点子集作为根委员会保证稳定的性能。无论网络中的故障数量如何，它都将典型的基于 BFT 的协议的二次消息复杂度提高到 $O(cn)$，Proteus 确保了与网络故障数量无关的一致性能，并降低了二次消息复杂性。

 针对单一委员会中领导者的恶意行为缺乏验证的问题，P.Berrang等人[45]提出一种新的基于推测BFT一致性算法和PoS的共识算法Albatross。该共识算法通过选择与权益成比例的验证者列表使其无需许可进入系统。Albatross使用随机可验证函数来增加对自适应对手的抵抗力，通过区块的推测BFT协议执行来提高达成一致的性能。该共识算法通过验证者机制检测节点的恶意行为、更换视图和惩罚机制来确保共识过程的安全性。此外，Albatross采用Bitcoin-NG的思想来提升处理交易的效率。

 单委员会混合共识算法具有强一致性，能够极大概率的降低区块链的分叉风险。采用基于PoW的滑窗机制或者随机机制重置委员会具有更新缓慢、耗能高和委员会成员容易被腐蚀的问题。而采用基于PoS机制的随机重置委员会更新迅速，能够抵抗敌手的腐蚀。但是如何快速安全地的配置初始委员会成员，新节点进入系统如何安全快速的自启，如何确保委员会诚实成员达到一定比例都是需要重点考虑的问题。

* **多委员会的混合区块链共识算法**
 为了提高区块链处理交易的可扩展性,利用多个并行的委员会来处理网络中不同分片的交易的混合共识算法被提出，也被称为分片共识算法。目前的分片分为通信分片、计算分片以及存储分片。
   * **通信分片** 将全网分为不同的片区，每个片区由一个对应的委员会处理。每个委员会内部成员大部分时间只需内部通信，每个分片内部的其他节点可以通过与该分片内委员会通信获得目前区块链的状态。
	* **计算分片** 每个分片委员会只负责处理其对应的交易，对交易运行委员会内一致性算法,验证该交易的合法性,最终决定该交易是否被添加到区块链中。计算分片使不同的交易以并行的形式被不同的委员会处理,当网络中节点数量增多时,可以增加更多的委员会,这样交易处理性能随着网络中节点数量的增多而增加, 进而实现了交易处理的可扩展性。
	* **存储分片** 在不同分片委员会将处理后的交易分片存储,每个分片委员会只负责处理本分片对应的交易,将交易放到本分片专属的交易区块链上。存储分片将整个区块链系统的交易数据或未花费的交易输出数据分片存储,降低了节点的存储负担。如果采用存储分片,那么可能每个分片各自生成和广播其区块链,不存在全局的区块链。

 为了提高交易处理的效率，L.Luu等人[46]提出通过分片并行处理交易的方式提升交易处理效率的共识算法ELASTICO。该共识算法将节点分为多组，每组委员会在一轮共识中会输出一个区块，通过最终共识委员会整合输出一个总区块。ELASTICO通过工作量证明和随机数的方式选择出一个时期内的共识节点可以避免女巫攻击和敌手偏置。该共识算法通过目录委员会机制来为多个委员会分配成员，委员会内部都运行PBFT一致性算法并将其内部共识结果发送给最终委员会。最终委员会内部也运行PBFT一致性协议对最终总区块达成共识，通过随机数生成协议为下一轮的共识节点的选择增加可验证性。但是这个共识算法抗偏置性差、且无法实现跨分片交易。分片共识在实现交易处理可扩展性的同时,引入了一些新安全性问题的问题。
   * **分片委员会配置** 委员会选举需要确保一定比例的诚实成员，分配分片委员会需要合理高效。需要解决新加入成员分配到不同委员会的过程受到敌手的偏置的问题,避免委员会冲恶意成员个数超过限制使得敌手可能控制委员会。因此,为了防止敌手在此过程中影响成员分配,需要设置合理的分配策略。针对委员会中的恶意行为是很难发现的，因此需要解决快速检测恶意委员并迅速恢复或者重置委员会的问题。
	* **委员会一致性算法** 需要解决分片委员会最终结果的整合问题，以及委员会共识的高效性问题。同时也需要设置安全的委员会首领的选举算法，当值首领不作为或恶意行为。委员会分片共识中,当不要求每个分片委员会数目相同时,当两个委员会之间交流过于频繁时,可以考虑将其合并为一个委员会,提高交易处理速度等。
	* **跨片交易** 需要解决多个分片共同协作安全和高效地处理。在过程中需要解决双花攻击、重放攻击[47]和交易锁死等问题,并且需要一定的方式提升交易的处理速度。在运行委员会内一致性算法步骤中,当一个交易包含多个输入且其属于不同分片时,需要多个分片协作完成对该交易的处理, 防止交易双花攻击。

 针对ELASTICO中分片共识中抗偏置性低以及无法跨片交易的问题，E.Kokoris-Kogias等人[48]提出跨片交易防锁死的共识算法Omniledger。该算法通过密码学抽签的方式确定首领，并通过RoundHound算法生成本轮随机数作为随机置换函数的种子对委员会成员进行分片，提高了委员会分配的抗偏置性。对于委员会重置问题，Omniledger设置合理的挖矿难度来部分替换委员会中的节点，被替换节点采用本轮随机数来进行选择，这样可以提高系统容错率和抗偏置性。针对跨分片的交易，Omniledger采用UTXO模型。网络中不同分片的节点只需处理和存储该分片对应的UTXO数据，利用原子性跨片交易防止跨片交易锁死。为了更好的防止敌手使得委员会选举出现偏置问题，文献[49]对Omniledger使用的随机数生成算法改进,采用公开可验证秘密分享算法确保了随机数的不可预测性、抗偏置性和公开可验证性。但是Omniledger的身份确认采用的工作量证明算法，使得每一轮委员会的重置会耗时较长，具有被敌手腐蚀的危险。同时，基于工作量证明的身份证明需要耗费大量算力，能耗巨大对环境不友好。

 针对交易和智能合约跨片处理的问题，M.Al-Bassam等人[50]提出了在分片跨分片交易的共识算法Chainspace。该共识算法将应用从加密货币上扩展到智能合约上。Chainspace通过将智能合约的执行和验证分离，提出BFT协议和原子提交协议结合的原子提交协议，实现了交易和智能合约的通信分片和计算分片，在确保其安全性的同时提供较高的交易吞吐量。但是Chainspace并没有考虑委员会的选择和分配问题，也没有考虑委员会重置问题，更没有解决节点的身份验证问题，也没有解决交易存储分片的问题。

 针对存储有限的问题，M.Zamani等人[51]提出的RapidChain很好实现了计算分片、通信分片和存储分片大大的提高了性能。这个共识算法主要包括启动 (bootstrap)过程、共识过程和重配置过程。对于初始委员的选举和创世块的生成RapidChain采用随机图（Random Graph）的方式选出根群组(Root Group)，利用根群组运行分布式随机数生成协议生成目录委员会，目录委员会再负责生成其他的分片委员会。该共识算法分时期运行，每个时期又分为多个轮，委员会内部每一轮采用使用同步拜占庭容错协议。为了防止自私挖矿攻击，节点通过加入随机数的工作量证明加入委员会。系统采用有界布谷鸟规则(Bounded Cuckoo Rule)尽量确保新节点替换掉委员会中不活跃的旧节点。该共识算法在网络层中采用消息扩散算法(Gossip Protocal)[52]能够将区块传播速度提升。RapidChain 对于跨分片交易采用将交易拆分的方式，并再对应交易所属的分片中达成共识，最终根据共识结果分片存储。这个方法实现了分片通信、分片计算和分片存储。但是由于每个时期中委员会内部的共识采用的是同步网络模型，这将导致交易确认不能满足快速响应的特性。

 针对跨分片事务处理会花费昂贵的问题，Y.Liu等人[53]提出了一种新颖的安全可扩展混合共识算法SSHC。该共识算法针对委员会成员的分配问题提出了一个公平的分片选择方案分片内共识，设计了流水线拜占庭容错算法将流水线技术与阈值签名相结合提高共识效率。SSHC采用一种响应式分片事务批处理机制来处理跨分片事务，从而减少了对拜占庭容错算法的调用次数。该共识算法设计了一种安全的委员会重新配置方法来有效地更新分片成员。SSHC采用正式的安全框架来设计和分析分片区块链，证明共识算法可以实现一致性和活性。

 针对随机分片系统的安全性和吞吐量不够高，合作的激励机制的开销大的问题，C.Huang等人[54]提出了基于声誉的安全快速的分片区块链共识算法RepChain。RepChain提出了一种基于声誉的分片和领导者选择方案，可以有效提高分片中诚实成员的比例，并且防止领导者不作为或者恶意行为。该共识算法采用一种新的双链架构—交易链和信誉链。对于交易链，提出了一种高效的基于 Raft 的同步共识。对于信誉链，结合集体签名的同步拜占庭容错共识被用来防止对信誉评分和相关交易块的攻击。同时，该共识算法为激发节点合作提供了高激励，并且支持具有中等生成速度的高吞吐量交易链。

 针对PBFT一致性算法通信复杂扩展性低的问题，W.Li和M.He[55]提出了一种分层和基于组的 BFT 共识算法—高效 BFT（EBFT）。 这个一致性算法利用一种新颖的网络拓扑结构来有效地减少节点之间的通信时间并提供O(n)的通信复杂度。通过将PBFT 算法中未分化的节点划分为不同的层和组，并提出分层和基于组的区块链模型。然后在这个模型的基础上修改了PBFT的共识协议，采用签名机制减少节点之间的通信提高性能。

 多委员会共识算法通过分片并行处理交易来提升区块链的交易吞吐量。这类共识算法相较于单一委员会共识算法引入新的问题需要解决。主要是跨分片交易处理问题、委员会成员动态管理问题以及恶意委员会检测与恢复问题。如果新加入成员分配到不同委员会的过程受到敌手的偏置,则可能造成某些委员会中恶意成员个数超过限制,敌手可能进一步控制委员会。如何检测恶意委员会并建立恢复机制是多委员会共识算法需要研究的重要问题.

* **其他共识算法**
 针对工作量证明能耗高对环境不友好的问题，一些人也研究了新的能耗低的身份证明算法。A.Miller等人[56]提出了Permacoin的文件存储证明共识算法。该共识算法要求参与者有能力存储大文件的一部分。通过一个挑战应答机制来确定节点是否存储了文件部分。如果应答成功，则该节点成功获得奖励。节点最保险的方式是存储整个文件，从而就会确保挑战成功的概率。但是这个共识算法需要存储资源，因此节点不可以通过伪造身份来获益，具有抗女巫攻击性。

 针对文件存储证明共识算法需要消耗大量的存储空间问题，S.Park等人[57]提出Spacecoin,采用非交互式空间证明(proof of space)达成共识。该算法以参与者能够使用的硬盘空间大小作为标准选出区块的生产者，节点通过一次性付出的硬盘空间来获得出块权限。为了防止硬盘空间造假，节点初次加入网络的时候根据选择的存储空间大小，存储一部分具有特定序列的数据。校验节点验证时向证明者发送一个挑战，证明节点根据挑战信息生成对应数据的哈希值给校验节点。校验节点再根据返回的值判定证明者是否硬盘空间造假。可以通过多次验证的方式来避免证明人的作弊行为。这个校验节点存储空间的方法在原来的文件存储证明的机制上加入了随机性，使得节点共识过程更具有公平性。但是存在无利益攻击、长程攻击和双花攻击的风险。

 针对之前的身份证明共识算法都具有资源消耗大、安全性低等问题，消逝时间证明[58]共识算法应运而生。这个共识算法是基于硬件芯片执行某个命令的等待时间来实现的,其实质是利用可信硬件产生随机数来决定下一个区块生产者。参与者在发布块之前都需要向Intel SGX中的飞地获取一个随机的等待时间,等待时间最短的节点被选为领导节点。这个算法可以提高交易吞吐量，减少能耗，并且具有很好的随机性，但是需要可信硬件的辅助，一旦硬件出现问题，则共识过程将不再可信。

 针对PoW共识算法能耗高，性能低以及PoS安全性低等问题，D.Schwartz等人[59]提出了Ripple共识算法，通过信任节点列表分别对交易和区块达成共识。在确保交易安全性的前提下提高性能。目前的交易确认时间只需要4s，吞吐量可高达1500TPS。但是这类共识算法的容错率比较低，并且通信复杂度比较高。

#### 2.3.2 DAG区块链共识算法
 
 单一主链的区块链系统的交易吞吐量的提升是非常有限的，这类区块链容易出现链分叉从而影响系统的安全性和扩展性。为了提升交易吞吐量，新的链存储结构—有向无环图（DAG）应运而生。DAG区块链中的每个单元代表用户发起的一笔交易,每一条从子单元指向父单元的有向边代表一种验证关系。用户创建交易的时候需要对先前的交易单元进行验证,将验证有效的交易单元的哈希值包含到自己的交易数据结构中。当前的交易单元称为子单元,被验证的交易称为当前单元的父单元。每笔交易可以有多个父单元,每个交易也可以有多个子单元,这样交易单元构成有向无环图的结构。历史交易数据不可篡改,一旦更改则会引起整个DAG区块链的变更。DAG区块链的交易处理速度随着网络中节点的增多而提高, 能够实现交易处理的可扩展性。 

* **节点自启机制** 区块链系统需要确保新加入节点能够快速获取可信区块链信息。由于基于DAG区块链的系统具有交易并发性，因此每个节点维护的账本是不同的，因此如何确保新加入的节点获取的是最新的账本是需要解决的问题。
* **双花攻击问题** 由于DAG区块链中允许分叉，因此容易被敌手利用发起交易双花攻击，共识算法需要对双花交易中的有效交易达成一致。
* **激励机制** DAG区块链没有挖矿费用，因此就没有奖励费用。共识算法需要解决节点由于没有收益而丧失活性和积极性的问题。
* **长程攻击问题** 由于节点生成交易并不需要耗费非常多的资源，因此节点可以通过伪造大量交易来确保自己的交易最终被确认。这些问题都会为DAG区块链带来安全方面的威胁。

基于DAG区块链的项目有IOTA[60]，Byteball(Obyte)[61]，Hashgraph[62]，Nano(RaiBlocks)[63]等。常见的DAG区块链共识算法有Tangle共识算法，基于主链的共识算法，基于平行链的共识算法。这些共识算法在为系统提高了交易处理性能的情况下，也面临着新的安全性问题。

* **Tangle共识算法**
 
 Tangle[60]是IOTA系统中采用的共识算法。在Tangle中引入权重的概念，每个交易都有一个自权重。交易的权重会随着之后直接或间接支持它的交易数量的增加而变大。当一个交易累积权重足够大，满足系统预设的确认阈值时，该交易将显示确认状态。理论上,如果整个网络中有足够多的交易流,则这个确认过程可以快到在几秒钟内完成。该共识机制的创新之处在于不采用网络中的一个子集(如矿工)来专门负责维护共识,而是全网所有的参与者都来进行网络交易的验证工作。Tangle算法实现共识的过程与交易产生过程是一体的,共识算法在运行的同时处理交易可以极大的提高交易处理效率。

 Tangle共识算法可以在没有任何交易费用的情况下极大的提高交易处理效率，但是会面临着一些新的安全问题。由于Tangle共识算法具有弱一致性，因此面临着双花攻击的风险。在Tangle中，交易的生成并不需要耗费资源，如果用户能够产生大量交易就可以随意控制区块链系统的共识。此外，没有交易费用就没有激励机制，这类区块链系统的活性很难保证，并且面临拒绝服务攻击和垃圾信息攻击。这个共识算法适用于具有大交易量的系统，一旦交易流变小就可能无法确认旧交易，最终影响安全性和性能。此外，新节点的安全自启机制也没有相应的解决方案。

 * **基于主链的共识算法**

 针对区块链中容易出现的双花问题，Byteball[61]采用基于主链的共识算法，通过建立与主链相关交易的全序来确认交易和处理交易双花的问题。主链通常使用见证人机制来构建。见证人通常是系统中长期实名且具有较高声誉的节点，他们维护系统并自愿频繁的发起交易单元，对于消极的见证人，可以被替换掉。最优父单元的选择是根据单元级别、见证级别以及交易的哈希值来确定的。通过选择最优父单元可以找到一条从任意顶端单元出发到创世单元的最优路径作为一条候选主链。多条候选主链会在某个交易单元处相交，这个相交的交易单元是一个稳定点。在每个节点中，从稳定点到创世单元的路径是相同的，这部分主链称为稳定主链。所有与稳定主链相关的交易单元可以进行一个全局排序，为每个单元分配一个主链号。最终建立在DAG区块链上的主链总序，使得全网达成共识。DAGCoin[64]是建立在Byteball上的区块链系统，因此采用相同的共识算法。但是Byteball中主链算法和见证人发布交易的频率有关系，交易确认的时间是不确定的。
 
 为了解决IOTA和Byteball中旧交易因交易流小而无法快速被确认甚至可能永远不会被确认的问题，TrustNote[65]采用双层共识的机制来解决。通过PoW的机制选择出公证共识的节点，公证节点将发布公正单元到DAG区块链上。公证共识根据公证单元严格确定其他单元的顺序。当公证单元成为主链上的稳定单元之后，公证节点才能获得公证奖励。通过找到一条以创世单元为起点的主链，并为相关交易根据主链分配主链号，建立一个主链全序来解决双花问题。为了避免出现垃圾交易，该共识算法要求所有节点提交新单元时支付交易费用。交易费用分别被支付给其最小哈希子单元和公证单元的节点。通过这个激励机制还可以吸引更多节点维护账本，确保系统活性。此外也激励节点尽可能引用最新的在靠近主链的父单元，有助于减少分叉。但是基于PoW的TrustME共识机制需要耗费大量的算力资源，且生成单元比较慢效率不够高。这个机制还面临自私挖矿攻击的危险，需要方法来防止计算资源集中化，使得算力较小的见证节点缺乏竞争力的问题。同时，还需要设置一个合理安全的节点自启机制来确保新节点获取信息的安全性。

* **基于平行链的共识算法**

 在基于平行链的DAG区块链共识算法中，网络各个参与共识的节点只需要维护记录本地信息的一条链，各链之间通过交互引用构成平行的DAG链形式。典型的代表是Hashgraph[62]和Nano[63].

 Hashgraph共识算法使用Gossip协议使得节点可以随机选择另一个节点传播自己的事件，通过对事件顺序和事件的时间达成共识达成最终共识。该共识算法采用虚拟投票机制和证人事件机制对事件的顺序达成共识。随后利用见证事件的顺序，根据事件的时间戳去中位数对非见证事件进行排序，最终实现所有事件的全局排序。这个全局排序很好的解决双花攻击的问题。Hashgraph是一种快速、公平和安全的共识算法，开创性的做异步BFT共识不会引发突发大规模消息传递风暴。
  
  Hashgraph利用Gossip协议和虚拟投票将共识所需的通信要求降到了最低，本地计算也保证了共识的高效性。但是这个算法的共识过程比较复杂，至少需要两轮才能确认事件，并且还未在大规模公链环境下运行，安全性还没有得到具体验证。同时，还需要设置节点的身份证明机制，确保节点身份的可信性。这个共识算法还需要相应的激励机制来确保节点的活性，且提高区块链系统的安全性。

 Nano[63]是一种基于区块点阵(Block Lattice)结构的新型加密货币，其共识算法采用了一个用户一条链的方式，只记录自己的交易，也只有自己可以修改自己的记录，不与其它账户共享数据。从而可以使交易都可以并行执行，能提供秒级的交易速度和无限可扩展性，并且允许他们异步更新到网络的其余部分，从而以极小的资源开销获得快速的交易确认。

 Nano中货币流通时，需要两个交易：货币发送交易和货币接收交易。交易数据的收发可以是异步的，因此允许多笔金额同时汇入一个账户。若出现节点离线，未到账的金额会被标记，直到节点在线时完成即可。针对交易分叉问题，Nano使用的DPoS共识算法允许账户指定代表为其投票，最终得票最多的代表会广播分叉并根据高权账户在固定时间内的投票结果确定哪个分支是有效的。同时Nano中也使用了PoW共识机制，但是主要是用于交易确认。此外，网络分离后重新加入时可能会影响投票过程和结果。每个节点维护自己的账本可以很好的避免自己账本被篡改的风险，如果敌手篡改自己的账本会立即被其他节点检查到，使得篡改无效。这个就不太需要设置节点账本自启机制，可以确保节点加入系统的安全性。但是需要安全获取系统其他节点身份信息的自启机制，确保能够获得可信的身份信息。基于DPoS共识算法存在中心化程度高的缺点,而其中的PoW共识算法则会耗费计算资源，会面临自私挖矿攻击的危险。

## 第三章 无线区块链共识算法问题分析

### 3.1 无线区块链系统

无线区块链系统是指无线网络节点共同对区块数据进行记录、存储、传输和使用的区块链系统。与传统的区块链系统相同，无线区块链系统能够确保数据信息的唯一不可变性，通过共识算法确保了区块链的一致性，通过加密签名机制、分布式存储和点对点传输加强了区块在存储和传输中的安全，去信任特性确保了使用的广泛和安全。区块链和无线网的结合存在一些问题。

从设备资源角度来说，当前的区块链技术（尤其是基于 PoW 的技术）是高计算能耗的，但大多数无线设备可能没有足够的计算能力、内存空间以及电力补充来运行和存储区块链。当前相关的研究工作集中在共识算法、信任和隐私等方面的区块链协议设计，而没有更多考虑有效的网络架构来支持低成本的无线区块链网系统。

从通信的角度来看，在传统的区块链系统中通常假设是节点之间的通信是完美的，没有延迟约束。无线网络通信时存在不稳定的信道质量、干扰、有限的资源和各种网络拓扑等问题，都会对无线区块链系统的性能产生极大的影响。一般来说，无线区块链系统在交易吞吐量（单位时间内确认交易的数量）、通信吞吐量（单位时间内传输的数据量）、交易成功率方面的性能应该与区块链交易到达率和无线网络节点的地理分布息息相关。考虑到易受攻击的无线链路，无线区块链网络面临的攻击的类型可能多种多样，比如女巫攻击、日蚀攻击、双花攻击等。

无线区块链系统的性能取决于所采用的共识算法，考虑到无线网络设备资源和环境需要设计一个高效的共识算法。设计无线区块链系统的共识算法主要面临几个挑战：
* 考虑无线设备有限的计算资源，共识算法需要满足高吞吐量、低能耗且对设备移动性不敏感 ；
* 由于无线节点之间的消息传输会相互影响。无线网络中消息传输的不确定性（消息传输可能会失败）和不稳定性（无法确保长长期高效的传输消息）导致在无线环境中难以达成共识；

传统的区块链共识算法设计时需要考虑节点自启问题、出块节点选举问题以及共识过程的效率问题。

### 3.2 节点自启

无线区块链系统中，新节点加入系统之后需要同步系统中的最新的区块链信息，这个过程就是节点的自启。节点自启机制包括新节点身份广播、其他节点身份信息获取、同步区块链。
* **节点身份广播**：节点第一次进入网络之后，通过广播自身ID(IP地址)给单跳邻居节点。接收到新节点信息的节点会将新的节点信息广播给它的单跳邻居节点。最终全网会知道新节点的ID（IP地址）。
* **节点获取其他节点信息**：节点会向邻居节点索取他们已知的其他节点的ID(IP地址)，可以获取其他节点的信息，方便之后建立与其他节点的通信连接。
* **数据同步**：节点进入网络之后会选择与邻居节点同步系统中的区块链。

在无线区块链系统中，无线链路的不稳定性使得敌手容易发起日蚀攻击。通过控制节点的接入使得节点与恶意节点链接，节点只能接收来自恶意节点的消息。日蚀攻击是一种针对点对点网络的攻击，对共识算法影响不大。但是，日蚀攻击对新节点的自启过程有较大的影响。如果新节点通过恶意节点接入系统，恶意节点会选择不广播新节点的身份，并且会同步陈旧或者错误的其他节点身份信息和区块链信息给新节点，最终使得新节点无法完成安全自启。

但是节点的自启机制关系到无线区块链系统的安全性，新节点只有安全自启后才能参与共识维护相同的区块链。因此，设计无线区块链共识算法之前，我们需要考虑无线区块链系统中节点自启问题。

### 3.3 出块节点选举

在区块链系统中，共识算法最重要的两个部分是出块节点的选举和达成共识的过程。出块节点的选举方式可以是轮循或者随机的方式。传统的区块链系统中出块节点的选举方式通常是随机竞争，比如工作量证明、权益证明、空间证明等方式选举出一个出块节点。

采用工作量证明选举出块节点的共识算法能够确保系统降低女巫攻击成功的概率。但是这种选举方式需要共识节点耗费大量的计算算力解决一个哈希难题。这对于计算资源有限的无线网络节点是非常不利的。采用权益证明选举出块节点的共识算法使用依赖初始代币，共识节点可以长期离线来累积币龄，节点上线时将大概率被选中成为出块节点。无线网络通信的不稳定和节点的动态性使得采用权益证明选举出块节点的共识算法面临公平性和安全性的问题。其他传统区块链系统的出块节点的选举方式也不适合直接用于无线区块链系统。

因此，我们需要根据无线区块链系统的特性设计出块节点选举方式。考虑无线节点通信不稳定性和敌手偏置问题，出块节点的选举过程需要高效、低能耗和可快速被其他节点验证。

### 3.4 共识过程

共识过程包括出块、验证区块、更新区块链几个阶段。节点会生成区块并广播到网络。其他共识节点接收到区块之后会验证交易、区块、出块节点的有效性，验证成功则更新本地区块链。
* **出块**：出块节点选举成功之后，会将接收到的交易排序并打包到区块中，最后广播区块到网络；
* **验证区块**：接收到区块的共识节点会对区块中的每笔交易都验证，确保区块中所有交易都是有效的，无效交易将不会被记录在区块链上；
* **更新区块链**：当共识节点成功验证交易的顺序和有效性后，会将区块链接到本地区块链上，并更新本地区块链的状态。

共识过程需要在网络中传输数据（交易或区块），无线网络通信时不稳定的信道、干扰和网络拓扑动态变化都会对节点之间的消息和数据传输产生时延。区块的大小、区块生成速率、无线网络节点的分布都会对共识过程产生较大的影响。因此，在考虑无线网络通信的情况下分析各种影响参数对区块链性能的影响，从而进一步提高共识的效率。

## 第四章 无线区块链共识算法问题解决方案

### 4.1 基于移动位置的随机自启机制

### 4.2 基于节点稳定度的共识节点选举机制

### 4.3 基于门限签名的区块确认机制

### 4.4 基于可验证随机函数的一致性算法

## 第五章 无线区块链共识算法研究相关成果

### 5.1 基于节点稳定度的区块链共识算法

### 5.2 稳定的委员会区块链共识算法 

### 5.3 稳定的分片区块链共识算法

### 5.4 基于稳定度的DAG区块链共识算法


## 第六章 回顾与展望


# 仿真实验分析

## 女巫攻击

假设攻击者被选中成为出块节点的概率为 $p_{A}$，其余 $m$ 个节点的概率分别为 $\{p_1, p_2, \cdots, p_m\}$。若攻击者发起女巫攻击，则攻击节点被选中的概率的期望 $\frac{1}{n}\sum_{k = 1}^n k\cdot p_k, (\sum_{k = 1}^n p_k = p_{A})$。此时有 $\frac{1}{n}\sum_{k = 1}^n k\cdot p_k < p_A$。
**证明**：令 $p_k = \frac{p_A}{n}$，则有 $\frac{1}{n}\sum_{k = 1}^n k\cdot p_k = \frac{1}{n}\sum_{k = 1}^n k\cdot \frac{p_A}{n} = p_A\sum_{k=1}^n\frac{k}{n^2} = p_A\frac{\sum_{k=1}^n k}{n^2}$。当 $n > 1$ 是有 $\sum_{k = 1}^n < n^2$ ，因此 $p_A\frac{\sum_{k=1}^n k}{n^2} < p_A, n>1$。最终得出结论 $\frac{1}{n}\sum_{k = 1}^n k\cdot p_k < p_A, n > 1$。因此，我们的协议中，攻击者发起女巫攻击时，成为出块节点的概率会降低。攻击者的伪造节点越多，则成为出块节点的概率将会越低。通常理性的节点不会愿意伪造多个节点降低成为出块节点的概率，因此我们的协议能够较好的抵抗女巫攻击。

## 激励节点签名

由于签名也需要耗费算力，理性的节点为了降低自身算力的消耗，在接收到新区块时将不会为区块签名，而是等待接收最终区块签名直接进入新一轮的共识进程。为了激励节点在有效区块上签名，我们设置最先对有效区块签名的 $\lceil\frac{N+1}{2}\rceil$ 个节点将获得部分区块奖励（或者交易费用作为奖励）。针对多个最终签名同时生成的问题，我们会给每个签名加上时间戳，形成最终签名的平均时间戳最小的签名份额所属的节点将获得签名奖励。

## 区块的奖励从何而来

可以将节点质押的金钱存入银行，其中的利息将会作为区块奖励。此外，每笔交易需要支付部分交易费用，节点就会打包尽可能多的交易提高他们的收益。这样就会尽可能提高节点的参与积极性。

## 节点选举出块节点

出块节点的选举与节点的剩余生存时间和近期共识比有关。但在系统运行初期，没有足够多的区块可以计算共识节点的共识比之前，节点的稳定度主要是通过节点的剩余活动时间决定。直到系统中生成区块的数量足够大时，节点的稳定度将由节点的剩余生存时间和共识比共同决定。


### 系统自启时

节点 $v$ 的稳定度计算公式为 
$$s_v = T_v$$
其中， $T_v$ 是节点 $v$ 的剩余活动时间。


### 系统运行一段时间后

节点 $v$ 的稳定度计算公式为 
$$s_v = \alpha\cdot T_v + \beta\cdot r_v$$
其中， $T_v$ 是节点 $v$ 的剩余活动时间，$r_v$ 是节点 $v$ 的共识比。

### 节点离线问题



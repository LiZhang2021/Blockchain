# 稳定共识算法实验

## 实验目标

我们在仿真实验中主要测试共识协议的性能，通过测试系统的**平均共识时延**和**平均交易吞吐量**来验证性能。影响这两个度量的指标是网络大小、区块大小和网络密度。
* **网络大小**：测试不同网络大小时交易吞吐量的变化趋势，分析交易处理效率。
* **区块大小**：测试不同的区块大小时吞吐量和时延的变化趋势，分析交易处理的效率。
* **网络密度**：测试不同网络密度的变化时的吞吐量和时延变化趋势，分析系统的交易处理效率。

分析系统女巫攻击和网络分区时的吞吐量变化情况来分析系统的安全性。
* **女巫攻击抗性**：通过测试系统在不同女巫节点数量时吞吐量的变化趋势，来分析系统抵抗女巫攻击的能力。
* **网络分区**：测试网络分区后各节点区块链的情况来分析系统对于网络分区情况的抗性。同时，也可以分析网络发生分区时，系统的吞吐量变化趋势来分析系统的性能。
  
**思考**：网络带宽和网络时延对共识时延和交易吞吐量影响大不大？可以仿真测试一下不同网络带宽、不同网络时延下无线区块链系统的性能。

## 实验方案

由于是在无线网络环境下仿真区块链系统，因此需要考虑无线网络的通信特征（可能需要用到无线网络仿真软件）。我们需要自己自己设计一个无线区块链系统测试系统的性能，也可以将我们的共识算法与PoW比较，来说明我们的协议具有更好的性能。

### 数据结构设计

我们需要考虑节点、交易和区块的数据结构：
 **节点的数据结构**需要包含：
 * 节点的ID：
 * 节点的位置：
 * 节点维护的区块链：
 * 节点的邻居：
 * 节点的活动时间：
 * 节点的稳定度表：

**交易的数据结构**需要包含：
* 交易的ID：TransID
* 交易发起方：Payer
* 交易收款方：Receiver
* 交易金额：count

**区块的数据结构**需要包含：
* 区块头：
  * 版本号：Version
  * 区块索引：Index(即区块高度)
  * 父块哈希：PreviousHash
  * 时间戳：TimeStamp
  * 默克尔根：MerkelRoot
  * 区块哈希：Hash
  * 区块生成节点ID: NodeID
  * 区块的签名份额：sigShares
* 区块体：
  * 交易数量：numTransactions
  * 交易数据：Transactions

### 节点功能

每个节点需要具备一定的功能：
**广播功能**
* 广播交易消息：
* 广播区块消息：
* 广播区块签名份额消息：

**接收功能**
* 接收交易消息：
* 接收区块消息：
* 接收区块签名份额消息：

节点还应该具有一些其他功能
* 计算节点稳定度并排序：
* 出块节点选举：
* 区块验证：交易验证和区块哈希验证；
* 同步最新区块链：
* 创建新区块：
* 添加区块到区块链：
* 添加签名份额到区块：
* 验证出块节点：
* 计算得到最终签名：
* 对签名份额计数：

## 记录的数据

在仿真过程中，考虑在不同网络大小，不同节点密度、不同区块大小、不同女巫攻击节点数量和网络分区下测量性能，我们需要记录如下数据：
* 每个区块的确认时延：记录区块生成的时间和最终签名生成的时间；
* 处理交易的数量：给定一个时间段，记录这个时间段内处理交易的总数量，最终得到平均交易吞吐量；


## 技术难点

  仿真实验主要的技术难点有：
  * 实现无线区块链网络的仿真：需要Socket编程的相关知识
  * 各节点并发工作：节点通过消息出发操作，如何实现？需要事件触发机制；
  * 交易的广播和区块的广播采用不同的线程：学习线程和进程相关的知识；
  * 节点广播冲突时的处理：无线网络的通信协议如何实现？
  * 节点分区的处理：如何将节点进行分区处理？
  * 女巫攻击节点如何实现：女巫节点需要具备什么特征？在共识中会有什么异常行为？

**思考**：
* 是否需要安装NS-3网络仿真软件？
* 采用什么编程语言（C++/Python）?
* 是否需要学习多线程和多进程相关知识？
* 如何通过接收消息触发节点操作，是否需要需要事件触发相关知识？


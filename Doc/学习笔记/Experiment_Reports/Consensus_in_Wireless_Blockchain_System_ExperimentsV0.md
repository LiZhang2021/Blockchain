
# 无线区块链系统中的共识算法实验（[论文](./../Blockchain_in_Wireless_Networks/papers/Wireless_Algorithms_Systems_And_Applications_p568(D.Yu&etal,%20Book,%202020).pdf)）

【描述：（一）实验目标，（二）实验方案（详细的实验方案，包括实验环境、实验步骤等），（三）技术难点（目前的技术难点、还需要补充的知识等）。】

## 一、实验目标

测试单跳无线区块链系统中，作者提出的共识算法在一个固定大小的举行区域和固定节点数量时，不同当选首领节点数量下达成共识所需的共识时长和共识错误率。

## 二、实验方案

### 2.1 仿真内容

* **无线区块链网络仿真**：
  * 搭建一个全连接的无线节点构成的网络；
  * 不考虑交易广播、打包区块等情况，只考虑节点之间达成共识的消息通信；
  * 节点存在四个状态：挖矿状态、沉默状态、候选者状态和首领状态；
  * 系统中的所有操作都是按轮进行的；
  * 根据无线节点的信号和信噪比的大小来确定节点的状态，并采取相应的操作（监听或者传输）；
  * 设置无线节点具有相同的传输概率和传输功率。
  
* **区块链共识算法仿真**：

仿真实现采用通信证明（PoC）共识算法达成无线区块链系统共识。
  * 初始化系统：所有节点初始状态都是挖矿状态，且竞争计数为零；
  * 首领节点选举：当节点的首领竞争计数超过 $k\cdot \log N$ 后，该节点当选为首领。
  * 区块生成：首领节点会广播消息（包括区块信息、位置信息、传输功率）到区块链网络。位置信息和传输功率时为了然接收节点判定在区块链网络中是否只有一个首领节点当选；
  * 区块验证：接收节点一旦发现当前的区块是无效或者区块链网络中首领节点不唯一，就会传输新的区块消息。首领节点根据信号强度决定是否接受新的区块。
  * 区块链更新：若存在多个首领节点或者新区块无效，首领节点会传输新的区块消息并且丢弃无效区块；同时沉默节点将会根据首领节点的决定丢弃无效区块。否则，所有节点会将新区块写入其本地区块链中，并转换为挖矿状态，开始新一轮挖矿。

### 2.2 系统设计

#### 2.2.1 节点设计

节点的主要功能有
* 生成节点ID、路由表、本地IP、本地区块链等初始化数据结构；
* 提供更新路由表、下载邻居节点的区块链；
* 处理广播消息。

创世节点启动流程
* 当一个节点在启动加入网络后ping过预先定义的节点后发现路由表为空；
* 节点新建区块链；
* 该节点创造一个新的交易，从特殊节点获取若干币；
* 该节点开始挖矿，加交易打包进创世区块
* 创世节点启动完毕，开始监听各种消息，根据命令输入发出相应消息

其他节点启动过程如下：
* 请求更新路由表
* 向邻居节点发送拉取区块链的消息，对收到的区块链进行长度的比较，保留最长的链，并序列化到本地

#### 2.2.2 共识算法设计

共识算法模拟流程如下：
* 所有共识节点启动完毕之后，新开一个线程，执行挖矿逻辑
* 某个节点获取出块权限后，从未处理交易池中将交易排序，并打包到生成的区块中；
* 节点将区块广播后，监听信道若没有多个首领节点，则更新区块链，开始新一轮共识。否则将重新发送新的区块；
* 节点接收到区块后，验证区块的有限性，若是有效，则更新区块链，否则丢弃当前区块；
* 开心新一轮的共识。

#### 2.2.3 参数设置

* **节点数量**：$N$个节点；
* **网络区域**：$100m\times 100m$，节点之间的最小距离为$1m$；
* **传输参数设置**：节点的传输概率为 $p_v$，节点的传输功率为 $P_v$是从一个区间中随机选择，确保任何一对节点都可以在无线网络中相互接收消息。
节点状态：首领状态，候选者状态、挖矿状态。

## 三、代码设计

### 3.1 节点数据结构

### 3.2 交易数据结构

### 3.3 区块数据结构

### 3.4 网络

### 3.5 共识算法
# 无线区块链系统

## 一、系统模块设计

本系统以无线节点模块为核心，搭建区块链仿真系统，主要功能有：
* 启动网状的无线网络；
* 实现无线节点之间的通信；
* 实现简化区块链；

### 1.1 系统启动模块

系统启动后，依次执行网络拓扑生成、启动网络、注册节点等操作，确保节点能在网络中正常通信。

### 1.2 节点模块

节点的主要功能有：
* 生成节点ID、路由表、本地IP、本地区块链等初始化数据结构；
* 提供更新路由表、下载邻居节点的区块链、挖矿等异步方法；
* 保存日志、序列化区块链；
* 处理广播、请求和回复等消息；

### 1.3 RPC发送和处理消息

发送消息：
* 发送请求
* 发送回复
* 发送广播

处理消息：
* 处理普通请求
* 处理回复消息
* 处理广播消息
* 处理超时消息
  
### 1.4 节点子模块

节点中的日志模块和区块链模块
* 日志模块：记录节点的操作
* 区块链模块：实现生成区块、验证区块、挖矿、挖矿结果证明等方法

## 二、系统中节点启动

### 2.1 创世节点启动

过程：
* 节点启动加入网络后，通过广播消息到预定义的节点后，发现路由表为空
* 节点创建一个区块链
* 节点创建一个新交易
* 节点开始挖矿，将交易打包进创世区块
* 创世节点启动完毕，可以监听各种消息

### 2.2 其他节点启动

过程：
* 节点发送请求路由表消息，获取路由表信息
* 节点向邻居节点发送拉取区块链的消息，对收到的区块链进行长度的比较，保留最长的链，并序列化到本地
* 节点新建交易，并广播给邻居节点
* 节点开启新线程，执行挖矿逻辑
* 启动事件监听和相应操作

## 三、共识算法的设计与实现

本实验对基于节点稳定性的共识算法进行建议模拟，稳定度高的节点有更大概率获得出块权限，然后获得奖励，主要模拟流程如下：
* 所有节点启动完毕之后，新开一个线程，执行出块节点选举逻辑
* 每个节点向其他节点广播其当前的稳定度
* 当所有节点都收到来自其他节点的稳定度广播后，使用相同的随机种子作VRF函数的输入，查看自己是否获得出块权限；
* 一旦某个节点确定自己当选为出块节点后将生成区块，从交易池中拉取交易，验证后放入区块中
* 该节点将新的区块广播后，等待其他节点发确认区块签名份额；
* 某一个节点一旦接收到某个新区块后，验证该新区块：
  * 如果验证区块有效且出块节点有效后，则发送确认区块签名份额；
  * 如果验证不通过，则不发送确认区块签名；
* 当节点收集到的相同的区块的确认签名份额达到阈值之后，组合得到区块的最新签名并广播；
* 某个节点接收到某个区块的最终签名后，将该区块添加到自己的链上
* 继续下一个区块

基于节点稳定性的共识算法根据节点的稳定性来确定出块节点，并且其他节点可以快速验证出块节点的有效性，降低了生成区块所需要消耗的算力。通过组合签名的方式可以快速确认区块，提高交易的处理效率。

### 3.1 实验内容

【实验一】：无线网络仿真
* 搭建一个全连通的网状无线区块链网络
* 节点之间进行通信
* 节点之间通过网络传输交易、区块、消息等数据

【实验二】：区块链系统仿真
* 实现区块链网络的仿真
* 模拟网络交易和区块的生成以及传播逻辑
* 实现基于稳定性的共识算法
* 测试不同节点数量下，区块确认时延、交易吞吐量情况
* 测试不同节点密度下，区块确认时延、交易吞吐量情况
  
### 3.2 需要补充的技术知识

* 如何实现多个节点同时挖矿（需要学习多线程相关的知识）
* 无线网络节点之间通信协议相关的知识（了解无线网络的通信过程和特征）
* 

